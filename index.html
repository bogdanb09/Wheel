<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Custom Spin the Wheel</title>
<style>
    body { font-family: Arial, sans-serif; text-align: center; background: #f0f0f0; }
    canvas { background: white; border-radius: 50%; }
    button, input, select { margin: 5px; padding: 5px 10px; }
    #editPanel, #adminPanel { display: none; background: #fff; padding: 10px; margin: 10px auto; width: 300px; border-radius: 10px; }
</style>
</head>
<body>
<h1>ðŸŽ¯ Spin the Wheel</h1>
<canvas id="wheelCanvas" width="400" height="400"></canvas><br>
<button id="spinBtn">Spin</button>
<button id="editBtn">Edit Wheel</button>
<button id="adminBtn">Admin Settings</button>
<select id="savedWheels"></select>
<button id="loadWheel">Load Wheel</button>
<button id="saveWheel">Save Wheel</button>

<div id="editPanel">
    <h3>Edit Wheel</h3>
    <input id="sliceText" placeholder="Slice Text">
    <input id="sliceColor" type="color">
    <button id="addSlice">Add Slice</button><br>
    <select id="sliceList"></select>
    <button id="removeSlice">Remove Selected</button>
</div>

<div id="adminPanel">
    <h3>Admin Settings</h3>
    <div id="adminLogin">
        <input id="adminPass" type="password" placeholder="Password">
        <button id="loginBtn">Login</button>
    </div>
    <div id="adminControls" style="display:none;">
        <h4>Probabilities</h4>
        <div id="probList"></div>
        <h4>Forced Order</h4>
        <div id="orderList"></div>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const canvas = document.getElementById("wheelCanvas");
    const ctx = canvas.getContext("2d");
    let slices = [{text:"Slice 1", color:"#ff0000"},{text:"Slice 2", color:"#00ff00"},{text:"Slice 3", color:"#0000ff"}];
    let probabilities = {}; 
    let forcedOrder = [];
    let spinning = false;
    let currentAngle = 0;

    function drawWheel() {
        let arc = 2 * Math.PI / slices.length;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        slices.forEach((slice, i) => {
            let angle = currentAngle + i * arc;
            ctx.beginPath();
            ctx.moveTo(200, 200);
            ctx.arc(200, 200, 200, angle, angle + arc);
            ctx.fillStyle = slice.color;
            ctx.fill();
            ctx.save();
            ctx.translate(200, 200);
            ctx.rotate(angle + arc / 2);
            ctx.textAlign = "right";
            ctx.fillStyle = "#fff";
            ctx.font = "16px Arial";
            ctx.fillText(slice.text, 180, 5);
            ctx.restore();
        });
    }

    function spinWheel() {
        if (spinning || slices.length === 0) return;
        spinning = true;
        let chosenIndex;
        if (forcedOrder.length > 0) {
            let next = forcedOrder.shift();
            chosenIndex = slices.findIndex(s => s.text === next);
        } else if (Object.keys(probabilities).length > 0) {
            let total = slices.reduce((sum, s) => sum + (probabilities[s.text] || 1), 0);
            let r = Math.random() * total;
            let acc = 0;
            for (let i = 0; i < slices.length; i++) {
                acc += (probabilities[slices[i].text] || 1);
                if (r <= acc) { chosenIndex = i; break; }
            }
        } else {
            chosenIndex = Math.floor(Math.random() * slices.length);
        }
        let arc = 2 * Math.PI / slices.length;
        let targetAngle = (3 * Math.PI / 2) - (chosenIndex * arc + arc / 2);
        let spins = 5;
        let finalAngle = spins * 2 * Math.PI + targetAngle;
        let start = null;
        function animate(time) {
            if (!start) start = time;
            let progress = (time - start) / 3000;
            if (progress < 1) {
                currentAngle = finalAngle * easeOut(progress);
                drawWheel();
                requestAnimationFrame(animate);
            } else {
                currentAngle = finalAngle;
                drawWheel();
                alert("Winner: " + slices[chosenIndex].text);
                slices.splice(chosenIndex, 1);
                drawWheel();
                spinning = false;
            }
        }
        requestAnimationFrame(animate);
    }
    function easeOut(t) { return 1 - Math.pow(1 - t, 3); }

    function refreshSliceList() {
        let sel = document.getElementById("sliceList");
        sel.innerHTML = "";
        slices.forEach((s, i) => {
            let opt = document.createElement("option");
            opt.value = i;
            opt.text = s.text;
            sel.add(opt);
        });
    }

    function refreshProbList() {
        let div = document.getElementById("probList");
        div.innerHTML = "";
        slices.forEach(s => {
            let input = document.createElement("input");
            input.type = "number";
            input.value = probabilities[s.text] || 1;
            input.oninput = () => { probabilities[s.text] = parseFloat(input.value); saveState(); };
            div.appendChild(document.createTextNode(s.text+": "));
            div.appendChild(input);
            div.appendChild(document.createElement("br"));
        });
    }

    function refreshOrderList() {
        let div = document.getElementById("orderList");
        div.innerHTML = "";
        slices.forEach(s => {
            let btn = document.createElement("button");
            btn.textContent = "Add "+s.text;
            btn.onclick = () => { forcedOrder.push(s.text); saveState(); refreshOrderList(); };
            div.appendChild(btn);
        });
        div.appendChild(document.createElement("br"));
        div.appendChild(document.createTextNode("Current Order: "+forcedOrder.join(", ")));
    }

    function saveState() {
        localStorage.setItem("currentWheel", JSON.stringify({slices, probabilities, forcedOrder}));
    }

    function loadState() {
        let saved = localStorage.getItem("currentWheel");
        if (saved) {
            let obj = JSON.parse(saved);
            slices = obj.slices || slices;
            probabilities = obj.probabilities || {};
            forcedOrder = obj.forcedOrder || [];
        }
    }

    document.getElementById("spinBtn").onclick = spinWheel;
    document.getElementById("editBtn").onclick = () => {
        document.getElementById("editPanel").style.display = "block";
        refreshSliceList();
    };
    document.getElementById("adminBtn").onclick = () => {
        document.getElementById("adminPanel").style.display = "block";
    };
    document.getElementById("addSlice").onclick = () => {
        let text = document.getElementById("sliceText").value;
        let color = document.getElementById("sliceColor").value || "#000";
        if (text) { slices.push({text, color}); refreshSliceList(); saveState(); drawWheel(); }
    };
    document.getElementById("removeSlice").onclick = () => {
        let idx = document.getElementById("sliceList").value;
        if (idx >= 0) { slices.splice(idx, 1); refreshSliceList(); saveState(); drawWheel(); }
    };
    document.getElementById("loginBtn").onclick = () => {
        if (document.getElementById("adminPass").value === "masluire") {
            document.getElementById("adminLogin").style.display = "none";
            document.getElementById("adminControls").style.display = "block";
            refreshProbList();
            refreshOrderList();
        } else alert("Wrong password");
    };
    document.getElementById("saveWheel").onclick = () => {
        let name = prompt("Enter wheel name:");
        if (name) {
            localStorage.setItem("wheel_"+name, JSON.stringify({slices, probabilities, forcedOrder}));
            refreshWheelList();
        }
    };
    document.getElementById("loadWheel").onclick = () => {
        let sel = document.getElementById("savedWheels");
        let saved = localStorage.getItem(sel.value);
        if (saved) {
            let obj = JSON.parse(saved);
            slices = obj.slices;
            probabilities = obj.probabilities;
            forcedOrder = obj.forcedOrder;
            saveState();
            drawWheel();
        }
    };
    function refreshWheelList() {
        let sel = document.getElementById("savedWheels");
        sel.innerHTML = "";
        for (let i = 0; i < localStorage.length; i++) {
            let key = localStorage.key(i);
            if (key.startsWith("wheel_")) {
                let opt = document.createElement("option");
                opt.value = key;
                opt.text = key.replace("wheel_", "");
                sel.add(opt);
            }
        }
    }

    loadState();
    refreshWheelList();
    drawWheel();
});
</script>
</body>
</html>
